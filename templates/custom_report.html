<!DOCTYPE html>
<html>
  <head>
    <title>Employees Report</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    />
  </head>
  <body>
    <p class="ml-3 mt-3 font-bold text-3xl text-gray-900 dark:text-white">
      Employees report
    </p>

    <p
      class="mt-1 ml-3 text-gray-500 whitespace-nowrap dark:text-gray-400 flex items-center"
    >
      <!--<i class="fa-regular fa-calendar mr-2"></i>-->
    </p>

    <div
      id="date-range-picker"
      date-rangepicker
      class="mt-1 ml-3 inline-flex items-center"
    >
      <div class="relative">
        <div
          class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"
        >
          <svg
            class="w-4 h-4 text-gray-500 dark:text-gray-400"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"
            />
          </svg>
        </div>
        <input
          id="datepicker-range-start"
          name="start"
          type="text"
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
          placeholder="Select date start"
        />
      </div>
      <span class="mx-4 text-gray-500">to</span>
      <div class="relative">
        <div
          class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"
        >
          <svg
            class="w-4 h-4 text-gray-500 dark:text-gray-400"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"
            />
          </svg>
        </div>
        <input
          id="datepicker-range-end"
          name="end"
          type="text"
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
          placeholder="Select date end"
        />
      </div>
    </div>
    <button
      id="submit-btn"
      onclick="getSelectedDates()"
      type="button"
      class="mt-3 ml-3 focus:outline-none text-white bg-purple-700 hover:bg-purple-800 focus:ring-4 focus:ring-purple-300 font-medium rounded-lg text-sm px-5 py-2.5 mb-2 dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-900"
    >
      Submit
    </button>

    <hr
      class="ml-3 h-px my-8 bg-gray-200 border-0 dark:bg-gray-700"
      style="width: 98%"
    />

    <div class="grid grid-cols-2 gap-1 mt-3 mb-3">
      <form class="ml-3 flex items-center">
        <label for="simple-search" class="sr-only">Search</label>
        <div class="relative w-full">
          <div
            class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"
          >
            <svg
              class="w-4 h-4 text-gray-500 dark:text-gray-400"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
          <input
            type="text"
            id="simple-search"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-purple-500 dark:focus:border-purple-500"
            placeholder="Search Username..."
            required
          />
        </div>
        <button
          type="submit"
          class="p-2.5 ms-2 text-sm font-medium text-white bg-purple-700 rounded-lg border border-purple-700 hover:bg-purple-800 focus:ring-4 focus:outline-none focus:ring-purple-300 dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-800"
        >
          <svg
            class="w-4 h-4"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 20 20"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"
            />
          </svg>
          <span class="sr-only">Search</span>
        </button>
      </form>

      <div class="ml-3">
        <div class="ml-3">
          <form
            id="download-report-form"
            enctype="application/json"
            action="/download-custom_report"
            method="post"
          >
            <button
              type="submit"
              class="text-white bg-purple-700 hover:bg-purple-800 focus:ring-4 focus:outline-none focus:ring-purple-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-800"
            >
              Download Report
            </button>
          </form>
        </div>
      </div>
    </div>

    <div
      class="ml-3 mt-3 relative overflow-x-auto shadow-md sm:rounded-lg"
      style="width: 98.5%"
    >
      <table
        class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"
      >
        <thead
          class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"
        >
          <tr>
            <th scope="col" class="px-6 py-3">Username</th>
            <th scope="col" class="px-6 py-3">Machine Name</th>
            <th scope="col" class="px-6 py-3">Total System Time (Hr.)</th>
            <th scope="col" class="px-6 py-3">Total Productive Hours</th>
            <th scope="col" class="px-6 py-3">Total Non-Productive Hours</th>
            <!--<th scope="col" class="px-6 py-3 ">
                        Indicator
                    </th> -->
          </tr>
        </thead>
        <tbody>
          {%for record in all_records%}
          <tr
            class="odd:bg-white odd:dark:bg-gray-900 even:bg-gray-50 even:dark:bg-gray-800 border-b dark:border-gray-700"
          >
            <th
              scope="row"
              class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white"
            >
              {{record[0]}}
            </th>
            <td class="px-6 py-4">{{record[1]}}</td>
            <td class="px-6 py-4">{{record[2]}}</td>
            <td class="px-6 py-4">{{record[3]}}</td>
            <td class="px-6 py-4">{{record[4]}}</td>

            <!--<td class="px-6 py-4">
                            {{record[7] | safe}}
                        </td> -->
          </tr>
          {%endfor%}
        </tbody>
      </table>
    </div>

    <script>
      function getSelectedDates() {
        const startDateInput = document.getElementById(
          "datepicker-range-start"
        );
        const endDateInput = document.getElementById("datepicker-range-end");

        const startDate = startDateInput.value;
        const endDate = endDateInput.value;
        const username = "{{ username }}";

        console.log("Selected Dates:");
        console.log("Start Date:", startDate);
        console.log("End Date:", endDate);

        // Send dates to Flask app using fetch API
        fetch("/get_dates_for_report", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            start_date: startDate,
            end_date: endDate,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            // Update the table content dynamically
            const tableBody = document.querySelector("table tbody");
            tableBody.innerHTML = "";
            data.all_records.forEach((record) => {
              const row = document.createElement("tr");
              row.innerHTML = `
                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  ${record[0]}
                </th>
                <td class="px-6 py-4">
                  ${record[1]}
                </td>
                <td class="px-6 py-4">
                  ${record[2]}
                </td>
                <td class="px-6 py-4">
                  ${record[3]}
                </td>
                <td class="px-6 py-4">
                  ${record[4]}
                </td>
                
              `;
              tableBody.appendChild(row);
            });
            // Update the date range text
            document.querySelector(
              "p.ml-3.mt-1.text-gray-500"
            ).innerText = `Date: ${startDate} to ${endDate}`;
          })
          .catch((error) => console.error(error));
      }
    </script>

    <script>
      // Get the form element
      const downloadReportForm = document.getElementById(
        "download-report-form"
      );

      // Add event listener to form submission
      downloadReportForm.addEventListener("submit", (e) => {
        e.preventDefault();

        // Get the start and end dates
        const startDateInput = document.getElementById(
          "datepicker-range-start"
        );
        const endDateInput = document.getElementById("datepicker-range-end");
        const startDate = startDateInput.value;
        const endDate = endDateInput.value;

        // Send dates to Flask app using fetch API
        fetch("/download-custom_report", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            start_date: startDate,
            end_date: endDate,
          }),
        }).then((response) => response.json())
          .then((data) => console.log(data))
          .catch((error) => console.error(error));
      });
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
  </body>
</html>
